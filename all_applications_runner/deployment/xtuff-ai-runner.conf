# Apache VirtualHost Configuration for xtuff.ai Main App Runner
# File: /etc/apache2/sites-available/xtuff-ai-runner.conf

<VirtualHost *:80>
    ServerName xtuff.ai
    ServerAlias www.xtuff.ai
    ServerAdmin wfzimmerman@gmail.com

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/xtuff-ai-error.log
    CustomLog ${APACHE_LOG_DIR}/xtuff-ai-access.log combined

    # Proxy configuration for Streamlit
    ProxyPreserveHost On
    ProxyPass / http://127.0.0.1:8500/
    ProxyPassReverse / http://127.0.0.1:8500/

    # WebSocket support (required for Streamlit)
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} =websocket [NC]
    RewriteRule /(.*)           ws://127.0.0.1:8500/$1 [P,L]
    RewriteCond %{HTTP:Upgrade} !=websocket [NC]
    RewriteRule /(.*)           http://127.0.0.1:8500/$1 [P,L]

    # Security headers
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"

    # Request headers
    RequestHeader set X-Forwarded-Proto "https" env=HTTPS
    RequestHeader set X-Forwarded-Host %{HTTP_HOST}e
</VirtualHost>
