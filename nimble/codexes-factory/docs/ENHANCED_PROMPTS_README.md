# Enhanced LLM Field Completion Prompts

This document provides an overview of the improvements made to the LLM field completion prompts for the LSI Field Enhancement Phase 4 project.

## Overview

The enhanced prompts are designed to improve the quality and success rate of LLM-based field completion for subjective fields in the LSI CSV output. The improvements focus on:

1. Adding more detailed instructions for each field type
2. Improving contributor information extraction
3. Ensuring LSI formatting requirements are met
4. Adding fallback value templates

## Key Improvements

### 1. More Detailed Instructions

Each prompt now includes a more detailed set of instructions with specific requirements for the field type. For example, the contributor bio prompt now specifies:

- Length: 100-150 words
- Third-person perspective
- Professional tone
- Highlight relevant expertise and credentials
- Include academic affiliations if applicable
- Mention professional positions if available
- Reference notable achievements related to the book topic
- Avoid speculative information
- Format for LSI metadata submission standards

### 2. Improved System Messages

The system messages have been enhanced to provide more context and guidance to the LLM. For example, the contributor bio system message now reads:

```
You are a professional book metadata specialist with expertise in creating contributor biographies for LSI submissions. Your task is to generate concise, professional biographies that highlight relevant expertise, credentials, and background information suitable for book metadata in the publishing industry.
```

### 3. Structured Output Format

Many prompts now request output in a specific format, such as JSON, to make it easier to extract the relevant information. For example, the BISAC codes prompt now requests:

```
Return a JSON object with these keys:
"bisac_category_2": "CODE",
"bisac_category_3": "CODE"
```

### 4. Fallback Values

Each prompt now includes a fallback value template that can be used if the LLM completion fails. For example, the contributor bio fallback is:

```
A respected expert in the field with extensive knowledge and experience related to {title}.
```

### 5. LSI-Specific Formatting Requirements

The prompts now include specific formatting requirements for LSI metadata submission. For example, the enhanced annotation prompt specifies:

```
1. Start with a dramatic hook in <b><i>bold italic</i></b> as the first paragraph
2. Use proper HTML formatting with these tags only: <p>, <b>, <i>, <br>
3. Structure the annotation in 3-5 paragraphs
4. Include compelling selling points and key themes
5. Incorporate storefront description and publisher notes naturally
6. Highlight the book's unique value proposition
7. End with a call-to-action or compelling reason to read
8. Maximum 4000 characters total (including HTML tags)
9. Ensure all HTML tags are properly closed
10. Format for LSI metadata submission standards
```

## Usage

The enhanced prompts are stored in `prompts/enhanced_lsi_field_completion_prompts.json` and can be used by specifying this path when initializing the `LLMFieldCompleter`:

```python
llm_completer = LLMFieldCompleter(
    model_name="gemini/gemini-2.5-flash",
    prompts_path="prompts/enhanced_lsi_field_completion_prompts.json"
)
```

## Testing

You can compare the results of the original prompts with the enhanced prompts using the `compare_prompts.py` script:

```bash
python compare_prompts.py <path_to_metadata_json> [--output-dir <output_directory>]
```

This script will generate a comparison report that shows the differences between the completions generated by the original and enhanced prompts.

## Expected Results

The enhanced prompts are expected to produce more accurate, detailed, and LSI-compliant field completions, resulting in a higher field population rate in the LSI CSV output.