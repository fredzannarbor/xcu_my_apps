# AI Coding Guidelines - Codexes-Factory

## Code Style
- Follow PEP 8 with 4-space indentation
- Use type hints for function parameters
- **Import complex types from typing (e.g., Dict, List, Any) for compatibility**
- Maximum line length: 88 characters
- Use f-strings for string formatting
- **Use Google-style docstrings for all functions and classes**
- **Include Args, Returns, and Raises sections where applicable**
- **Use snake_case for functions and variables, CamelCase for classes**

## Streamlit Specific
- Always use session state for persistent data
- **Initialize st.session_state keys at app startup with default values**
- **Example: `if 'key' not in st.session_state: st.session_state['key'] = default`**
- Include proper error handling for user inputs
- **Validate form inputs before processing (e.g., check for None or empty values)**
- **Use st.form() for better state management in user inputs**
- Use st.rerun() instead of st.experimental_rerun()
- Implement proper cart management with user/session keys
- **Use st.cache_resource for database connections or API clients**
- Use st.cache_data for static or computed data
- Use st.navigation instead of hard-coded page file names
- Use use_container_width instead of use_column_width
- **Store authentication tokens in st.session_state**
- **Validate tokens before API calls to prevent 401 errors**
- **Pin Streamlit version in requirements.txt with greater than logic (e.g., streamlit>=1.38.0)**
- **Test new Streamlit features against pinned version**

## Translation System

- **Log missing translations as WARNING for debugging**
- **Store user language preference in st.session_state**
- **Allow dynamic language switching via UI controls (e.g., st.selectbox)**
- **Use python-gettext or dictionary-based systems for internationalization**
- **Avoid unmaintained or non-existent packages (e.g., streamlit-i18n)**

## Error Handling
- Use try-except blocks for file operations and API calls
- Display user-friendly error messages with st.error()
- **Format st.error() as: “Error: [message] (Code: [error code])”**
- Include context in error messages for debugging
- **Implement retry logic for API calls using libraries like tenacity**
- **Retry on transient errors (e.g., 429, 503) with exponential backoff**
- **Sanitize user inputs to prevent injection or malformed data**

## Logging
- Configure logging at application startup
- Use structured logging format: timestamp, level, module, message
- Include appropriate logging levels:
  - DEBUG: Detailed debug information
  - INFO: General operational events
  - WARNING: Unexpected but handleable situations
  - ERROR: Critical issues requiring attention
  - CRITICAL: System-breaking issues
- Implement both file and console handlers
- **Generate request IDs using uuid.uuid4()**
- **Store request IDs in st.session_state for session tracking**
- Set log rotation by size (10MB) and time (daily)
- Store logs in 'logs' directory with dated filenames
- Include stack traces for ERROR and CRITICAL levels
- Use context managers for temporary log level changes
- **Example context manager:**
  ```python
  @contextmanager
  def temporary_log_level(level):
      logger = logging.getLogger()
      old_level = logger.level
      logger.setLevel(level)
      yield
      logger.setLevel(old_level)
  
## Library Preferences

- Use PyMuPDF for PDF manipulation
- Tex/LuLaTeX for typesetting
- pypandoc for conversion
- Stripe for e-commerce
- litellm for model selection & utilization